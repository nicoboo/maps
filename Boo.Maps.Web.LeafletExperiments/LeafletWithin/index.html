<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Leaflet - Within Experiments</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

    <style type="text/css">
        body { font-family: Arial; }
        header, footer { margin: 0 auto; width: 960px; }
        .clr { clear: both; }

        .header-content-logo { float: left; }
        .header-content-title { font-size: 11px; color: #444; float: right; margin-top: 16px; }

        .top-shadow { background-image: url('../img/ui-banner_shadow.png'); height: 20px; width: 858px; margin: 0 auto; }
        .bottom-shadow { background-image: url('../img/ui-footer_shadow.png'); height: 20px; width: 858px; margin: 0 auto; }
        
        .content { max-width: 960px; margin: 0 auto; }
        .map { height: 600px; margin: 20px auto; }

        .footer-content { margin: 10px 0; font-size: 12px; }
    </style>

    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../scripts/lib/javascript.util.js"></script>
    <script src="../scripts/lib/jsts.js"></script>
    <script src="../scripts/lib/require.js"></script>

    <script type="text/javascript">
        var routeCoordinatesA = [[50.619512, 3.061242], [50.617822, 3.061248], [50.617822, 3.061162], [50.617811, 3.061071], [50.61779, 3.061012], [50.617758, 3.060947], [50.617752, 3.060781], [50.618278, 3.050519], [50.618358, 3.050519], [50.618589, 3.050288], [50.618632, 3.049848], [50.618498, 3.049569], [50.618208, 3.049532], [50.618128, 3.049451], [50.617758, 3.049038], [50.617452, 3.048411], [50.617221, 3.047579], [50.617028, 3.046302], [50.617017, 3.045122], [50.617092, 3.041372], [50.617532, 3.033058], [50.61764, 3.032178], [50.617838, 3.031362], [50.618219, 3.030429], [50.618669, 3.029769], [50.620708, 3.028069], [50.621448, 3.027259], [50.621953, 3.02632], [50.622178, 3.025462], [50.62229, 3.024517], [50.622221, 3.023267], [50.620627, 3.013858], [50.619372, 3.004572], [50.616642, 2.991698], [50.616357, 2.989847], [50.61625, 2.987948], [50.616357, 2.985432], [50.616599, 2.983667], [50.617028, 2.981838], [50.617361, 2.980792], [50.61912, 2.976211], [50.621438, 2.970889], [50.622521, 2.968819], [50.624179, 2.966008], [50.631651, 2.954227], [50.632762, 2.952328], [50.63421, 2.949271], [50.63641, 2.94359], [50.63744, 2.941412], [50.638309, 2.93991], [50.648952, 2.923489], [50.650191, 2.921381], [50.651409, 2.919069], [50.653039, 2.91555], [50.654219, 2.9126], [50.655389, 2.909182], [50.65776, 2.901157], [50.658071, 2.90039], [50.658522, 2.899398], [50.659198, 2.89855], [50.65982, 2.898142], [50.660308, 2.897998], [50.6607, 2.897998], [50.660721, 2.898089], [50.660812, 2.898239], [50.660941, 2.898287], [50.66107, 2.898239], [50.661182, 2.897992], [50.661848, 2.898271], [50.663108, 2.89877], [50.664508, 2.8998], [50.667078, 2.903029], [50.667561, 2.903469], [50.668768, 2.904199], [50.668961, 2.90458], [50.669041, 2.90532], [50.66902, 2.90539], [50.669041, 2.905819], [50.66931, 2.906119], [50.669471, 2.906098], [50.669621, 2.905969], [50.669728, 2.905551], [50.669792, 2.905502], [50.669969, 2.905181], [50.670318, 2.904027], [50.671278, 2.900251], [50.671799, 2.89906], [50.672512, 2.896887], [50.673161, 2.894371], [50.676498, 2.889071], [50.676519, 2.889109], [50.676637, 2.889178], [50.676761, 2.88905], [50.676771, 2.888851], [50.676637, 2.888701], [50.67667, 2.888572], [50.677152, 2.88765], [50.677179, 2.887542], [50.678499, 2.874029], [50.678708, 2.873858], [50.679422, 2.873311], [50.679448, 2.87337], [50.67955, 2.873429], [50.679652, 2.87338], [50.67969, 2.873069], [50.679958, 2.872849], [50.68057, 2.872442], [50.681262, 2.872431], [50.681498, 2.87249], [50.682088, 2.872629], [50.682098, 2.872758], [50.68219, 2.872908], [50.682302, 2.87294], [50.682469, 2.872758], [50.682431, 2.872388], [50.68234, 2.872307], [50.68219, 2.87234]];
        var routeCoordinatesB = [[50.619512, 3.061242], [50.617822, 3.061248], [50.617822, 3.061162], [50.617811, 3.061071], [50.61779, 3.061012], [50.617758, 3.060947], [50.617752, 3.060781], [50.618278, 3.050519], [50.618358, 3.050519], [50.618589, 3.050288], [50.618632, 3.049848], [50.618498, 3.049569], [50.618208, 3.049532], [50.618128, 3.049451], [50.617758, 3.049038], [50.617452, 3.048411], [50.617221, 3.047579], [50.617028, 3.046302], [50.617017, 3.045122], [50.617092, 3.041372], [50.617532, 3.033058], [50.61764, 3.032178], [50.617838, 3.031362], [50.618219, 3.030429], [50.618669, 3.029769], [50.620708, 3.028069], [50.621448, 3.027259], [50.621953, 3.02632], [50.622178, 3.025462], [50.62229, 3.024517], [50.622221, 3.023267], [50.620627, 3.013858], [50.619372, 3.004572], [50.616642, 2.991698], [50.616357, 2.989847], [50.61625, 2.986972], [50.616427, 2.984778], [50.616749, 2.982932], [50.617361, 2.980792], [50.61963, 2.974961], [50.621438, 2.970889], [50.622521, 2.968819], [50.624179, 2.966008], [50.631651, 2.954227], [50.632762, 2.952328], [50.63421, 2.949271], [50.63641, 2.94359], [50.63744, 2.941412], [50.638309, 2.93991], [50.648952, 2.923489], [50.650588, 2.920652], [50.65194, 2.917969], [50.653721, 2.913871], [50.65511, 2.910041], [50.659418, 2.895492], [50.660292, 2.893132], [50.661258, 2.890938], [50.662218, 2.8892], [50.667089, 2.881389], [50.66807, 2.879667], [50.668929, 2.877961], [50.669712, 2.876138], [50.67263, 2.86793], [50.673328, 2.866181], [50.679422, 2.853291], [50.680612, 2.850222], [50.682259, 2.84563], [50.682688, 2.84474], [50.683847, 2.842411], [50.684239, 2.8421], [50.68477, 2.842208], [50.685151, 2.842562], [50.685349, 2.842739], [50.685462, 2.842851], [50.68565, 2.843071], [50.68566, 2.843152], [50.685752, 2.84334], [50.685859, 2.843382], [50.685998, 2.843302], [50.686068, 2.843109], [50.685971, 2.842771], [50.685859, 2.842717], [50.68573, 2.842782], [50.685617, 2.842771], [50.684099, 2.841559], [50.679518, 2.837471], [50.677871, 2.835599], [50.675902, 2.834327], [50.675661, 2.834129], [50.675479, 2.833759], [50.675479, 2.833721], [50.675371, 2.833448], [50.675189, 2.833469], [50.67506, 2.833319], [50.67484, 2.833088], [50.674508, 2.832128], [50.672121, 2.824221], [50.669819, 2.81405], [50.669159, 2.813229], [50.66829, 2.811748], [50.667727, 2.8125], [50.666472, 2.814018], [50.665522, 2.815402], [50.664181, 2.816721], [50.664052, 2.816442], [50.663242, 2.813851], [50.66254, 2.812408], [50.661622, 2.810869], [50.659251, 2.807881], [50.6585, 2.806738], [50.6568, 2.805048], [50.655518, 2.804179], [50.65511, 2.803782], [50.650792, 2.794781], [50.650202, 2.793799], [50.649059, 2.792592], [50.648689, 2.792501], [50.648351, 2.792539], [50.648152, 2.792458], [50.646768, 2.790672], [50.64598, 2.788601], [50.645518, 2.78601], [50.645089, 2.784701], [50.645111, 2.784669], [50.645089, 2.784497], [50.644987, 2.784508], [50.644928, 2.784438], [50.644252, 2.78343], [50.64252, 2.781268], [50.641581, 2.780399], [50.640932, 2.77938], [50.638239, 2.776011], [50.637348, 2.774058], [50.636678, 2.772867], [50.635712, 2.77202], [50.634999, 2.771601], [50.633792, 2.770518], [50.63318, 2.770169], [50.63317, 2.770121], [50.633089, 2.770088], [50.633062, 2.770169], [50.632821, 2.770249], [50.631968, 2.770421], [50.631228, 2.770201], [50.630831, 2.769949], [50.630772, 2.77004], [50.63023, 2.770121], [50.628508, 2.771108]];

        $(function () {
            var map = L.map('map').setView([47.5, 2.75], 5);

            // Add base tile layer - sample from Leaflet website
            L.tileLayer('http://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            var polylineA = L.polyline(routeCoordinatesA, { color: '#4b98dc' }).addTo(map);
            var polylineB = L.polyline(routeCoordinatesB, { color: '#de6262' }).addTo(map);


            var geometryFactory = new jsts.geom.GeometryFactory();

            // Coordinates adapted to match for jsts
            var coordsA = [];
            $.each(routeCoordinatesA, function (idx, current) { coordsA.push([current[1], current[0]]); });

            var coordsB = [];
            $.each(routeCoordinatesB, function (idx, current) { coordsB.push([current[1], current[0]]); });

            // Element A
            var coordinatesA = bindCoord2JTS(coordsA);
            var shellA = geometryFactory.createLinearRing(coordinatesA);
            var jstsPolygonA = geometryFactory.createPolygon(shellA);

            // Element b
            var coordinatesB = bindCoord2JTS(coordsB);
            var shellB = geometryFactory.createLinearRing(coordinatesB);
            var jstsPolygonB = geometryFactory.createPolygon(shellB);

            // Interection
            var bufferTolerance = (2 / 1000);   // Small buffer to avoid different node no detection
            var intersection = shellA.buffer(bufferTolerance).intersection(shellB);  

            var intersectionPoints = [];
            $.each(intersection.getCoordinates(), function (idx, current) {
                intersectionPoints.push([current.x, current.y]);
            });
            intersectionPoints.pop();
            var intersectionLine = L.polyline(intersectionPoints, { color: '#4fc281', weight: 8 }).addTo(map);

            map.fitBounds(routeCoordinatesA.concat(routeCoordinatesB));
        });


        var bindCoord2JTS = function (coords) {
            var coordinates = [];
            for (var i = 0; i < coords.length; i++) {
                coordinates.push(new jsts.geom.Coordinate(
                    coords[i][1], coords[i][0]));
            }
            return coordinates;
        };
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-content-logo">
                <img src="../img/logo-xp.png" alt="Leaflet logo" />
            </div>
            <div class="header-content-title">
                <h1>Intersection with Turf</h1>
            </div>
            <div class="clr"></div>
            <div class="top-shadow"></div>
        </div>
    </header>
    <section class="content">
        <div id="map" class="map"></div>
    </section>
    <footer>
        <div class="bottom-shadow"></div>
        <div class="footer-content">
            Nicolas Boonaert - 2014
        </div>
    </footer>
</body>
</html>
